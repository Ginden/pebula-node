<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-11687894-9","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-11687894-9","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<title data-react-helmet="true">Provisioning | Service Bus extension for NestJS</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Provisioning | Service Bus extension for NestJS"><meta data-react-helmet="true" name="description" content="Provisioning adds management capabilities over your service bus entities."><meta data-react-helmet="true" property="og:description" content="Provisioning adds management capabilities over your service bus entities."><meta data-react-helmet="true" property="og:url" content="https://shlomiassaf.github.io/pebula-node/nesbus/pebula-node/nesbus/docs/guide/provisioning">

<link data-react-helmet="true" rel="shortcut icon" href="/pebula-node/nesbus/img/favicon.ico">


<link rel="stylesheet" href="/pebula-node/nesbus/styles.868e102b.css">


<link rel="preload" href="/pebula-node/nesbus/styles.6748c9e2.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/runtime~main.863c7777.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/main.f2b960e5.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/1.9865b271.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/2.0d6e6d78.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/3.2d9ec37b.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/1be78505.0195dc53.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/ff79d901.1532164c.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/17896441.668377fb.js" as="script">

<link rel="preload" href="/pebula-node/nesbus/8f2d2d1a.48f46fc8.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/pebula-node/nesbus/"><img class="navbar__logo" src="/pebula-node/nesbus/img/logo.svg" alt="@pebula/nesbus"><strong class="navbar__title">@pebula/nesbus</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pebula-node/nesbus/docs/getting-started/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://github.com/shlomiassaf/pebula-node/tree/master/packages/nesbus" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_3Bv7"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_1Xww moon_3Sj-"></span></div><div class="react-toggle-track-x"><span class="toggle_1Xww sun_fR9s"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/pebula-node/nesbus/"><img class="navbar__logo" src="/pebula-node/nesbus/img/logo.svg" alt="@pebula/nesbus"><strong class="navbar__title">@pebula/nesbus</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="left" href="/pebula-node/nesbus/docs/getting-started/introduction">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/shlomiassaf/pebula-node/tree/master/packages/nesbus" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_3I0Z"><div class="docSidebarContainer_pJ1M"><div class="sidebar_RVqL"><div class="menu menu--responsive menu_1sbL"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1qwL" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pebula-node/nesbus/docs/getting-started/introduction">1. Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pebula-node/nesbus/docs/getting-started/installation">2. Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pebula-node/nesbus/docs/getting-started/basic-example">3. Basic Usage</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pebula-node/nesbus/docs/guide/declaration">1. Declaration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pebula-node/nesbus/docs/guide/configuration">2. Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pebula-node/nesbus/docs/guide/emitters">3. Emitters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pebula-node/nesbus/docs/guide/receivers">4. Receivers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pebula-node/nesbus/docs/guide/the-context">5. The Context</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" tabindex="0" href="/pebula-node/nesbus/docs/guide/provisioning">6. Provisioning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pebula-node/nesbus/docs/guide/interceptors">7. Interceptors</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tasks</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pebula-node/nesbus/docs/tasks/introduction">1. Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pebula-node/nesbus/docs/tasks/back-off">2. Backoff And Retry</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pebula-node/nesbus/docs/tasks/idempotent-subscriber">3. Idempotent Subscriber</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Recipes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pebula-node/nesbus/docs/recipes/dynamic-entity-configuration">1. Dynamic Entity Configuration</a></li></ul></li></ul></div></div></div><main class="docMainContainer_1qxC"><div class="container padding-vert--lg docItemWrapper_2Soj"><div class="row"><div class="col docItemCol_1--W"><div class="docItemContainer_TEEl"><article><header><h1 class="docTitle_2EkC">Provisioning</h1></header><div class="markdown"><p>Provisioning adds management capabilities over your service bus entities.</p><p>If you try to register to a queue, topic or subscription that does not exist, service bus will throw an error.
With provision enabled, you can instruct <strong>nestbus</strong> to verify (eager, on load) that the entity exist and if not create it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="basic-provisioning"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-provisioning" title="Direct link to heading">#</a>Basic Provisioning</h2><p>The most basic provision configuration is to decide what level of provisioning are we doing:</p><ul><li><strong>skip</strong> [default] - provision is disabled</li><li><strong>verify</strong> - verify entity exists when the server bootstraps, throw if it does not exist (eager check)</li><li><strong>verifyCreate</strong> - verify entity exists when the server bootstraps, create the entity if it does not exists</li></ul><div class="mdxCodeBlock_1wf8"><div class="codeBlockContent_3yfC"><button type="button" aria-label="Copy code to clipboard" class="copyButton_3GO8">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_2u0D"><div class="codeBlockLines_YTN2" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ServiceBusController</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @</span><span class="token maybe-class-name">Queue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">MethodDecorator</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;nesbus-queue.demo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    provision</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;verifyCreate&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// or &#x27;skip&#x27; or &#x27;verify&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">myQueueEntity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">@</span><span class="token parameter function" style="color:rgb(130, 170, 255)">Ctx</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token parameter"> context</span><span class="token parameter operator" style="color:rgb(137, 221, 255)">:</span><span class="token parameter"> SbContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>This is a valid configuration but it is not enough by itself.</p><p>What happens when the library detects that an entity does not exist and it needs to create it?
Creating a new service bus entity require additional configuration.</p><p>Moreover, the configuration we need is based on the type of the entity, i.e. creating a <code>subscription</code> is different than creating a <code>queue</code>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>That being said, setting <code>provision: &#x27;verifyCreate&#x27;</code> is a valid definition with the help of a small adapter, more on this in a couple of paragraphs.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="management-clients"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#management-clients" title="Direct link to heading">#</a>Management Clients</h2><p>Verifying and/or creating entities requires management capabilities so we can create/update entities in service bus.
To enable provisioning we must provide a management configuration otherwise it is disabled.</p><p>There are currently 2 management clients available:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="arm-client"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#arm-client" title="Direct link to heading">#</a>ARM Client</h3><p>The official service bus management package offered by azure, when using this client you must install the package:</p><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tab-item tabItem_niFb tab-item--active">Yarn</li><li role="tab" tabindex="0" aria-selected="false" class="tab-item tabItem_niFb">NPM</li></ul><div role="tabpanel" class="margin-vert--md"><div><div class="mdxCodeBlock_1wf8"><div class="codeBlockContent_3yfC"><button type="button" aria-label="Copy code to clipboard" class="copyButton_3GO8">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_2u0D"><div class="codeBlockLines_YTN2" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> @azure/arm-servicebus</span></div></div></div></div></div></div></div></div><p>Then configure the management client when registering the module we need to provide the management
configuration <a href="https://shlomiassaf.github.io/pebula-node/nesbus/api-docs/interfaces/sbmanagementclientarmoptions.html" target="_blank">SbManagementClientArmOptions</a>:</p><div class="mdxCodeBlock_1wf8"><div class="codeBlockContent_3yfC"><button type="button" aria-label="Copy code to clipboard" class="copyButton_3GO8">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_2u0D"><div class="codeBlockLines_YTN2" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">ApplicationTokenCredentials</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@azure/ms-rest-nodeauth&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">Module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@nestjs/common&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">ServiceBusModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">SbServerOptions</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@pebula/nesbus&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sbServerOptions</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">SbServerOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    client</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Client configuration options... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    management</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      credentials</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        host</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> &#x27;my</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">service</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">bus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">servicebus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">windows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">net</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        resourceGroupName</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;NorthEurope&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">namespace</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;my-service-bus&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        subscriptionId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        credentials</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ApplicationTokenCredentials</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// clientId,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// tenantId,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;K2.329cnlw3293:#@Mc2EK#)CKE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// clientSecret,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  imports</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">ServiceBusModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> servers</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> sbServerOptions </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AppModule</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>In this example, the credentials used are <code>ApplicationTokenCredentials</code> but you can use any token credentials object
which implements the <code>getToken()</code> interface.</p><p>In most cases, one of the following from the <code>@azure/ms-rest-nodeauth</code> package:</p><ul><li>ApplicationTokenCredentials</li><li>UserTokenCredentials</li><li>DeviceTokenCredentials</li><li>MSITokenCredentials Token audience (or resource in case of MSI based credentials) to use when creating the credentials is <a href="https://servicebus.azure.net/">https://servicebus.azure.net/</a></li></ul><p>For more details see the API Docs for <a href="https://shlomiassaf.github.io/pebula-node/nesbus/api-docs/interfaces/servicebusmanagementaadtokencredentials.html" target="_blank">ServiceBusManagementAadTokenCredentials</a> </p></div></div><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p><code>@azure/arm-servicebus</code> supports authentication &amp; authorization through azure active directory.</p><p>This has 2 limitations:</p><ul><li>You will need to manage permissions through azure&#x27;s role based authorization model.</li><li>You can not use connection strings to connect to service bus.</li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="atom-client-experimental"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#atom-client-experimental" title="Direct link to heading">#</a>ATOM Client (experimental)</h3><p>The ATOM Client is a management client the uses and authentication and authorization model based on a connection string, which is not possible
when using the <code>@azure/arm-servicebus</code> library.</p><p>The client is in development by the <code>@azure/service-bus</code> team and is planned to release with the <code>@azure/service-bus</code> pacakge.</p><p>The client itself is operational but not publicly exposed.</p><p>To allow using it today, <strong>nesbus</strong> includes a copy of the ATOM client from the <code>@azure/service-bus</code> repository, with no changes.
Once officially released the copy will be removed and the original ATOM client will be used instead. If things go as planned
this will go unnoticed, without breaking changes.</p><div class="mdxCodeBlock_1wf8"><div class="codeBlockContent_3yfC"><button type="button" aria-label="Copy code to clipboard" class="copyButton_3GO8">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_2u0D"><div class="codeBlockLines_YTN2" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">Module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@nestjs/common&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">ServiceBusModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">SbServerOptions</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@pebula/nesbus&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sbServerOptions</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">SbServerOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    client</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Client configuration options... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    management</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      credentials</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        connectionString</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MY-SAS-CONNECTION-STRING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  imports</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">ServiceBusModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> servers</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> sbServerOptions </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AppModule</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="entity-creation-configuration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#entity-creation-configuration" title="Direct link to heading">#</a>Entity Creation Configuration</h2><p>Instead of setting <code>provision: &#x27;verifyCreate&#x27;</code> we can set <code>provision</code> to an object that contains the configuration required when creating an entity:</p><div class="mdxCodeBlock_1wf8"><div class="codeBlockContent_3yfC"><button type="button" aria-label="Copy code to clipboard" class="copyButton_3GO8">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_2u0D"><div class="codeBlockLines_YTN2" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">ServiceBusController</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @</span><span class="token maybe-class-name">Queue</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">MethodDecorator</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;nesbus-queue.demo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    provision</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">type</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;verifyCreate&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      params</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Default, entity specific, values */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        deadLetteringOnMessageExpiration</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        maxSizeInMegabytes</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        defaultMessageTtl</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;P14D&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        lockDuration</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;PT5M&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* ... Additional, entity specific, provisioning values */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">myQueueEntity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">@</span><span class="token parameter function" style="color:rgb(130, 170, 255)">Ctx</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token parameter"> context</span><span class="token parameter operator" style="color:rgb(137, 221, 255)">:</span><span class="token parameter"> SbContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="params"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#params" title="Direct link to heading">#</a>Params</h3><p>The <strong>params</strong> property is an object that defines the default values that each entity instance will have when created.</p><p>This type differs based on the provision context, i.e. the decorator used.</p><ul><li>For Queue see <a href="https://docs.microsoft.com/en-us/javascript/api/@azure/arm-servicebus/sbqueue" target="_blank">SBQueue</a></li><li>For Topic see <a href="https://docs.microsoft.com/en-us/javascript/api/@azure/arm-servicebus/sbtopic" target="_blank">SBTopic</a></li><li>For Subscription see <a href="https://docs.microsoft.com/en-us/javascript/api/@azure/arm-servicebus/sbsubscription" target="_blank">SBSubscription</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="additional-provision-configuration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#additional-provision-configuration" title="Direct link to heading">#</a>Additional Provision Configuration</h3><p>The additional provision configuration also depends on the entity being provisioned.</p><p>For example, a <strong>Subscription</strong> is a child entity of <strong>Topic</strong>, you can create a nested provision option
to also run a provision to make sure that the topic exists.</p><p>See the API docs for more details:</p><ul><li><a href="https://shlomiassaf.github.io/pebula-node/nesbus/api-docs/interfaces/sbqueueentityprovision.html" target="_blank">SbQueueEntityProvision</a></li><li><a href="https://shlomiassaf.github.io/pebula-node/nesbus/api-docs/interfaces/sbtopicentityprovision.html" target="_blank">SbTopicEntityProvision</a></li><li><a href="https://shlomiassaf.github.io/pebula-node/nesbus/api-docs/interfaces/sbtopicsubscriptionentityprovision.html" target="_blank">SbTopicSubscriptionEntityProvision</a></li><li><a href="https://shlomiassaf.github.io/pebula-node/nesbus/api-docs/interfaces/sbruleentityprovision.html" target="_blank">SbRuleEntityProvision</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_3THn" id="entity-configuration-adapter"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#entity-configuration-adapter" title="Direct link to heading">#</a>Entity Configuration Adapter</h2><p>We&#x27;ve started with a simple provision definition: <code>provision: &#x27;verifyCreate&#x27;</code>.
In most cases, our entities will have the same setup, wouldn&#x27;t it be great to have all of this set from one place and use
the simple definition?</p><p>We can do this by providing an special adapter that the management client will use, when creating new entities.</p><p>We register the adapter along with the management options we provide when registering a management client:</p><div class="mdxCodeBlock_1wf8"><div class="codeBlockContent_3yfC"><button type="button" aria-label="Copy code to clipboard" class="copyButton_3GO8">Copy</button><div tabindex="0" class="prism-code language-ts codeBlock_2u0D"><div class="codeBlockLines_YTN2" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">Module</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@nestjs/common&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">ServiceBusModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">SbServerOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">SbManagementDefaultsAdapter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@pebula/nesbus&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> defaults</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">SbManagementDefaultsAdapter</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sbServerOptions</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">SbServerOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    client</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Client configuration options... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    management</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      credentials</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        connectionString</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MY-SAS-CONNECTION-STRING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Here we register the default configuration for entities.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@</span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  imports</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token maybe-class-name">ServiceBusModule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> servers</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> sbServerOptions </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">AppModule</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>The adapter contains an <code>entities</code> property, with a definition for each type of entity:</p><div class="mdxCodeBlock_1wf8"><div class="codeBlockContent_3yfC"><button type="button" aria-label="Copy code to clipboard" class="copyButton_3GO8">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_2u0D"><div class="codeBlockLines_YTN2" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  entities</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    queue</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">SbQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    topic</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">SbTopic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    subscription</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">SbSubscription</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>These values will go to the <code>params</code> property in the provision definition.</p><p>In addition, an optional handler can be set to handle the creation of new rules when a new subscription is created.</p><p>For more information, read the API Docs for <a href="https://shlomiassaf.github.io/pebula-node/nesbus/api-docs/interfaces/sbmanagementdefaultsadapter.html" target="_blank">SbManagementDefaultsAdapter</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/shlomiassaf/pebula-node/tree/master/packages/nesbus/website/docs/guide/provisioning.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/pebula-node/nesbus/docs/guide/the-context"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« The Context</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/pebula-node/nesbus/docs/guide/interceptors"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Interceptors »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_9y0s"><ul class="contents contents__left-border"><li><a href="#basic-provisioning" class="contents__link">Basic Provisioning</a></li><li><a href="#management-clients" class="contents__link">Management Clients</a><ul><li><a href="#arm-client" class="contents__link">ARM Client</a></li><li><a href="#atom-client-experimental" class="contents__link">ATOM Client (experimental)</a></li></ul></li><li><a href="#entity-creation-configuration" class="contents__link">Entity Creation Configuration</a><ul><li><a href="#params" class="contents__link">Params</a></li><li><a href="#additional-provision-configuration" class="contents__link">Additional Provision Configuration</a></li></ul></li><li><a href="#entity-configuration-adapter" class="contents__link">Entity Configuration Adapter</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/shlomiassaf/pebula-node/tree/master/packages/nesbus">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Shlomi Assaf, Inc. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/pebula-node/nesbus/styles.6748c9e2.js"></script>

<script src="/pebula-node/nesbus/runtime~main.863c7777.js"></script>

<script src="/pebula-node/nesbus/main.f2b960e5.js"></script>

<script src="/pebula-node/nesbus/1.9865b271.js"></script>

<script src="/pebula-node/nesbus/2.0d6e6d78.js"></script>

<script src="/pebula-node/nesbus/3.2d9ec37b.js"></script>

<script src="/pebula-node/nesbus/1be78505.0195dc53.js"></script>

<script src="/pebula-node/nesbus/ff79d901.1532164c.js"></script>

<script src="/pebula-node/nesbus/17896441.668377fb.js"></script>

<script src="/pebula-node/nesbus/8f2d2d1a.48f46fc8.js"></script>


</body>
</html>